<Window xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:MTM_Template_Application.ViewModels"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="600"
    x:Class="MTM_Template_Application.Views.MainWindow"
    x:DataType="vm:MainViewModel"
    x:CompileBindings="True"
    Icon="/Assets/avalonia-logo.ico"
    Title="MTM Template Application"
    Width="900" Height="600"
    MinWidth="800" MinHeight="500"
    ExtendClientAreaToDecorationsHint="True"
    ExtendClientAreaChromeHints="NoChrome"
    ExtendClientAreaTitleBarHeightHint="40"
    Background="{DynamicResource SystemChromeLowColor}">
    <Design.DataContext>
        <vm:MainViewModel />
    </Design.DataContext>

    <!-- Desktop Main Window - Boot Information Placeholder with Custom Title Bar -->
    <Grid RowDefinitions="40,Auto,*,Auto,Auto">

        <!-- Custom Title Bar -->
        <Border Grid.Row="0"
            Background="{DynamicResource SystemAccentColor}"
            PointerPressed="TitleBar_PointerPressed"
            Cursor="Hand">
            <Grid ColumnDefinitions="Auto,*,Auto" Margin="8,0">

                <!-- App Icon and Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="10"
                    VerticalAlignment="Center">
                    <Viewbox Width="20" Height="20">
                        <Canvas Width="24" Height="24">
                            <Ellipse Width="24" Height="24"
                                Fill="{DynamicResource SystemAccentForegroundColor}" Opacity="0.9" />
                            <TextBlock Text="M"
                                FontSize="14"
                                FontWeight="Bold"
                                Foreground="{DynamicResource SystemAccentColor}"
                                Canvas.Left="7"
                                Canvas.Top="4" />
                        </Canvas>
                    </Viewbox>
                    <TextBlock Text="MTM Template Application"
                        FontSize="13"
                        FontWeight="SemiBold"
                        Foreground="{DynamicResource SystemAccentForegroundColor}"
                        VerticalAlignment="Center" />
                </StackPanel>

                <!-- Center Space -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                    <Button Command="{CompiledBinding OpenDebugTerminalCommand}"
                        Background="Transparent"
                        BorderThickness="1"
                        BorderBrush="{DynamicResource SystemAccentForegroundColor}"
                        Foreground="{DynamicResource SystemAccentForegroundColor}"
                        Padding="12,4"
                        CornerRadius="4"
                        FontSize="12"
                        Cursor="Hand">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <TextBlock Text="ðŸ”§" FontSize="14" VerticalAlignment="Center" />
                            <TextBlock Text="Debug Terminal" VerticalAlignment="Center" />
                        </StackPanel>
                        <Button.Styles>
                            <Style Selector="Button:pointerover">
                                <Setter Property="Background"
                                    Value="{DynamicResource SystemAccentForegroundColor}" />
                                <Setter Property="Foreground"
                                    Value="{DynamicResource SystemAccentColor}" />
                            </Style>
                            <Style Selector="Button:pressed">
                                <Setter Property="Opacity" Value="0.8" />
                            </Style>
                        </Button.Styles>
                    </Button>
                </StackPanel>

                <!-- Window Controls -->
                <StackPanel Grid.Column="2"
                    Orientation="Horizontal"
                    Spacing="0"
                    IsHitTestVisible="True">

                    <!-- Minimize Button -->
                    <Button Click="MinimizeWindow"
                        Width="46" Height="40"
                        Background="Transparent"
                        BorderThickness="0"
                        CornerRadius="0"
                        Padding="0"
                        Cursor="Hand"
                        Content="âˆ’"
                        FontSize="16"
                        Foreground="{DynamicResource SystemAccentForegroundColor}"
                        VerticalContentAlignment="Center"
                        HorizontalContentAlignment="Center">
                        <Button.Styles>
                            <Style Selector="Button:pointerover">
                                <Setter Property="Background"
                                    Value="{DynamicResource SystemListLowColor}" />
                            </Style>
                            <Style Selector="Button:pressed">
                                <Setter Property="Background"
                                    Value="{DynamicResource SystemListMediumColor}" />
                            </Style>
                        </Button.Styles>
                    </Button>

                    <!-- Maximize/Restore Button -->
                    <Button Click="MaximizeWindow"
                        Width="46" Height="40"
                        Background="Transparent"
                        BorderThickness="0"
                        CornerRadius="0"
                        Padding="0"
                        Cursor="Hand"
                        Content="â–¡"
                        FontSize="14"
                        Foreground="{DynamicResource SystemAccentForegroundColor}"
                        VerticalContentAlignment="Center"
                        HorizontalContentAlignment="Center">
                        <Button.Styles>
                            <Style Selector="Button:pointerover">
                                <Setter Property="Background"
                                    Value="{DynamicResource SystemListLowColor}" />
                            </Style>
                            <Style Selector="Button:pressed">
                                <Setter Property="Background"
                                    Value="{DynamicResource SystemListMediumColor}" />
                            </Style>
                        </Button.Styles>
                    </Button>

                    <!-- Close Button -->
                    <Button Click="CloseWindow"
                        Width="46" Height="40"
                        Background="Transparent"
                        BorderThickness="0"
                        CornerRadius="0"
                        Padding="0"
                        Cursor="Hand"
                        Content="âœ•"
                        FontSize="14"
                        Foreground="{DynamicResource SystemAccentForegroundColor}"
                        VerticalContentAlignment="Center"
                        HorizontalContentAlignment="Center">
                        <Button.Styles>
                            <Style Selector="Button:pointerover">
                                <Setter Property="Background"
                                    Value="{DynamicResource SystemErrorTextColor}" />
                            </Style>
                            <Style Selector="Button:pressed">
                                <Setter Property="Background"
                                    Value="{DynamicResource SystemErrorTextColor}" />
                            </Style>
                        </Button.Styles>
                    </Button>

                </StackPanel>
            </Grid>
        </Border>

        <!-- Header Section -->
        <Border Grid.Row="1"
            Background="{DynamicResource SystemChromeLowColor}"
            BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
            BorderThickness="0,0,0,1"
            Padding="24,16">
            <StackPanel Spacing="4">
                <TextBlock Text="{CompiledBinding Greeting}"
                    FontSize="22"
                    FontWeight="Bold"
                    Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}" />
                <TextBlock Text="Desktop Application"
                    FontSize="14"
                    Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
            </StackPanel>
        </Border>

        <!-- Main Content (No ScrollViewer) -->
        <Grid Grid.Row="2" ColumnDefinitions="*,*" Margin="20,16">

            <!-- Left Column: Status Cards -->
            <StackPanel Grid.Column="0" Spacing="16" Margin="0,0,10,0">

                <!-- Application Status Card -->
                <Border Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                    BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                    BorderThickness="1"
                    CornerRadius="6"
                    Padding="16">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Application Status"
                            FontSize="16"
                            FontWeight="SemiBold"
                            Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}" />

                        <StackPanel Spacing="8">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Border Background="{DynamicResource SystemAccentColor}"
                                    Width="6" Height="6"
                                    CornerRadius="3"
                                    VerticalAlignment="Center" />
                                <TextBlock
                                    Text="Boot sequence completed"
                                    FontSize="13"
                                    Foreground="{DynamicResource SystemControlForegroundBaseMediumHighBrush}" />
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Border Background="{DynamicResource SystemAccentColor}"
                                    Width="6" Height="6"
                                    CornerRadius="3"
                                    VerticalAlignment="Center" />
                                <TextBlock Text="All services initialized"
                                    FontSize="13"
                                    Foreground="{DynamicResource SystemControlForegroundBaseMediumHighBrush}" />
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Border Background="{DynamicResource SystemAccentColor}"
                                    Width="6" Height="6"
                                    CornerRadius="3"
                                    VerticalAlignment="Center" />
                                <TextBlock Text="Ready for operation"
                                    FontSize="13"
                                    Foreground="{DynamicResource SystemControlForegroundBaseMediumHighBrush}" />
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Platform Info Card -->
                <Border Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                    BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                    BorderThickness="1"
                    CornerRadius="6"
                    Padding="16">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Platform Information"
                            FontSize="16"
                            FontWeight="SemiBold"
                            Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}" />

                        <StackPanel Spacing="6">
                            <Grid ColumnDefinitions="100,*">
                                <TextBlock Grid.Column="0"
                                    Text="Platform:"
                                    FontSize="13"
                                    Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                                <TextBlock Grid.Column="1"
                                    Text="Windows Desktop"
                                    FontSize="13"
                                    FontWeight="Medium"
                                    Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}" />
                            </Grid>

                            <Grid ColumnDefinitions="100,*">
                                <TextBlock Grid.Column="0"
                                    Text="Framework:"
                                    FontSize="13"
                                    Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                                <TextBlock Grid.Column="1"
                                    Text="Avalonia UI 11.3+"
                                    FontSize="13"
                                    FontWeight="Medium"
                                    Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}" />
                            </Grid>

                            <Grid ColumnDefinitions="100,*">
                                <TextBlock Grid.Column="0"
                                    Text="Runtime:"
                                    FontSize="13"
                                    Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                                <TextBlock Grid.Column="1"
                                    Text=".NET 9.0"
                                    FontSize="13"
                                    FontWeight="Medium"
                                    Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}" />
                            </Grid>
                        </StackPanel>
                    </StackPanel>
                </Border>

            </StackPanel>

            <!-- Right Column: Boot Logs -->
            <Border Grid.Column="1"
                Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                BorderThickness="1"
                CornerRadius="6"
                Padding="16"
                Margin="10,0,0,0"
                IsVisible="{CompiledBinding HasBootLogs}">
                <Grid RowDefinitions="Auto,Auto,*">

                    <!-- Boot Logs Header -->
                    <TextBlock Grid.Row="0"
                        Text="Boot Sequence Logs"
                        FontSize="16"
                        FontWeight="SemiBold"
                        Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                        Margin="0,0,0,12" />

                    <!-- Boot Metrics -->
                    <Border Grid.Row="1"
                        Background="{DynamicResource SystemAccentColor}"
                        Opacity="0.1"
                        BorderBrush="{DynamicResource SystemAccentColor}"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="12"
                        Margin="0,0,0,12">
                        <Border.OpacityMask>
                            <SolidColorBrush Color="White" Opacity="1" />
                        </Border.OpacityMask>
                        <Grid ColumnDefinitions="*,*">
                            <StackPanel Grid.Column="0" Spacing="2">
                                <TextBlock Text="Duration"
                                    FontSize="11"
                                    Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                    FontWeight="Medium" />
                                <TextBlock
                                    Text="{CompiledBinding BootDurationMs, StringFormat='{}{0}ms'}"
                                    FontSize="18"
                                    FontWeight="Bold"
                                    Foreground="{DynamicResource SystemAccentColor}" />
                            </StackPanel>

                            <StackPanel Grid.Column="1" Spacing="2">
                                <TextBlock Text="Memory Used"
                                    FontSize="11"
                                    Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                    FontWeight="Medium" />
                                <TextBlock
                                    Text="{CompiledBinding BootMemoryMB, StringFormat='{}{0:F1}MB'}"
                                    FontSize="18"
                                    FontWeight="Bold"
                                    Foreground="{DynamicResource SystemAccentColor}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Logs ScrollViewer -->
                    <Border Grid.Row="2"
                        Background="{DynamicResource SystemChromeHighColor}"
                        BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                        BorderThickness="1"
                        CornerRadius="4">
                        <ScrollViewer VerticalScrollBarVisibility="Auto"
                            HorizontalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{CompiledBinding BootLogs}"
                                Margin="8">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}"
                                            FontSize="10"
                                            FontFamily="Consolas,Courier New,monospace"
                                            Foreground="{DynamicResource SystemControlForegroundBaseMediumHighBrush}"
                                            TextWrapping="NoWrap"
                                            Margin="0,1" />
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Border>

                </Grid>
            </Border>

        </Grid>

        <!-- Status Bar for Error Notifications (T020) -->
        <Border Grid.Row="3"
            Background="{DynamicResource ThemeV2.Warning.Background}"
            BorderBrush="{DynamicResource ThemeV2.Warning.Border}"
            BorderThickness="0,1,0,0"
            Padding="16,8"
            IsVisible="{CompiledBinding HasActiveErrors}"
            Cursor="Hand"
            PointerPressed="StatusBar_PointerPressed">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <!-- Warning Icon -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8"
                    VerticalAlignment="Center">
                    <TextBlock Text="âš "
                        FontSize="16"
                        Foreground="{DynamicResource ThemeV2.Warning.Default}"
                        VerticalAlignment="Center" />
                    <TextBlock FontSize="13"
                        FontWeight="SemiBold"
                        Foreground="{DynamicResource ThemeV2.Text.Primary}"
                        VerticalAlignment="Center">
                        <Run Text="{CompiledBinding ActiveErrors.Count, FallbackValue=0}" />
                        <Run Text=" configuration warning(s)" />
                    </TextBlock>
                </StackPanel>

                <!-- Error Messages (first 3) -->
                <ItemsControl Grid.Column="1"
                    ItemsSource="{CompiledBinding ActiveErrors}"
                    Margin="16,0">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Message}"
                                FontSize="12"
                                Foreground="{DynamicResource ThemeV2.Text.Secondary}"
                                TextTrimming="CharacterEllipsis"
                                MaxWidth="500"
                                VerticalAlignment="Center" />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal" Spacing="12" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>

                <!-- Click to View Details -->
                <TextBlock Grid.Column="2"
                    Text="Click to view details â†’"
                    FontSize="12"
                    FontStyle="Italic"
                    Foreground="{DynamicResource ThemeV2.Text.Secondary}"
                    VerticalAlignment="Center" />
            </Grid>
        </Border>

        <!-- Footer -->
        <Border Grid.Row="4"
            Background="{DynamicResource SystemChromeLowColor}"
            BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
            BorderThickness="0,1,0,0"
            Padding="20,10">
            <TextBlock Text="Â© 2025 MTM Template Application"
                FontSize="11"
                Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                HorizontalAlignment="Center" />
        </Border>

    </Grid>
</Window>
