<Window xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:MTM_Template_Application.Models.Configuration"
    mc:Ignorable="d" d:DesignWidth="550" d:DesignHeight="350"
    x:Class="MTM_Template_Application.Views.Configuration.ConfigurationErrorDialog"
    x:DataType="models:ConfigurationError"
    x:CompileBindings="True"
    Title="Configuration Error"
    Width="550" Height="350"
    MinWidth="500" MinHeight="300"
    MaxWidth="700" MaxHeight="500"
    CanResize="False"
    WindowStartupLocation="CenterOwner"
    ShowInTaskbar="False"
    Icon="/Assets/avalonia-logo.ico">

    <Design.DataContext>
        <models:ConfigurationError />
    </Design.DataContext>

    <Window.Styles>
        <!-- Dialog Container Style -->
        <Style Selector="Border.ErrorDialogContainer">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Surface.Background}" />
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeV2.Error.Border}" />
            <Setter Property="BorderThickness" Value="2" />
            <Setter Property="CornerRadius" Value="{DynamicResource ThemeV2.CornerRadius.Large}" />
            <Setter Property="Padding" Value="24" />
        </Style>

        <!-- Error Header Style -->
        <Style Selector="Border.ErrorHeader">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Error.Background}" />
            <Setter Property="CornerRadius" Value="{DynamicResource ThemeV2.CornerRadius.Medium}" />
            <Setter Property="Padding" Value="16,12" />
            <Setter Property="Margin" Value="0,0,0,20" />
        </Style>

        <!-- Error Title Style -->
        <Style Selector="TextBlock.ErrorTitle">
            <Setter Property="FontSize" Value="18" />
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="Foreground" Value="{DynamicResource ThemeV2.Error.Default}" />
        </Style>

        <!-- Error Message Style -->
        <Style Selector="TextBlock.ErrorMessage">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Foreground" Value="{DynamicResource ThemeV2.Text.Primary}" />
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="LineHeight" Value="22" />
        </Style>

        <!-- Error Details Style -->
        <Style Selector="TextBlock.ErrorDetails">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Foreground" Value="{DynamicResource ThemeV2.Text.Secondary}" />
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="FontFamily" Value="Consolas,Courier New,monospace" />
        </Style>

        <!-- User Action Style -->
        <Style Selector="Border.UserActionBox">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Info.Background}" />
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeV2.Info.Border}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="{DynamicResource ThemeV2.CornerRadius.Medium}" />
            <Setter Property="Padding" Value="12" />
            <Setter Property="Margin" Value="0,16,0,0" />
        </Style>

        <!-- Button Styles -->
        <Style Selector="Button.RetryButton">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Primary.Default}" />
            <Setter Property="Foreground" Value="{DynamicResource ThemeV2.Text.OnPrimary}" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="CornerRadius" Value="{DynamicResource ThemeV2.CornerRadius.Medium}" />
            <Setter Property="Padding" Value="24,10" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="MinWidth" Value="100" />
            <Setter Property="Height" Value="40" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>

        <Style Selector="Button.RetryButton:pointerover">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Primary.Hover}" />
        </Style>

        <Style Selector="Button.RetryButton:pressed">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Primary.Active}" />
        </Style>

        <Style Selector="Button.CloseButton">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="{DynamicResource ThemeV2.Text.Secondary}" />
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeV2.Border.Default}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="{DynamicResource ThemeV2.CornerRadius.Medium}" />
            <Setter Property="Padding" Value="24,10" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="MinWidth" Value="100" />
            <Setter Property="Height" Value="40" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>

        <Style Selector="Button.CloseButton:pointerover">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Surface.Hover}" />
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeV2.Border.Hover}" />
        </Style>

        <Style Selector="Button.CloseButton:pressed">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Surface.Active}" />
        </Style>
    </Window.Styles>

    <!-- Main Content -->
    <Grid RowDefinitions="*,Auto">
        <!-- Error Content -->
        <Border Classes="ErrorDialogContainer" Grid.Row="0" Margin="0">
            <StackPanel Spacing="0">
                <!-- Error Header -->
                <Border Classes="ErrorHeader">
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <TextBlock Text="⚠"
                            FontSize="24"
                            Foreground="{DynamicResource ThemeV2.Error.Default}"
                            VerticalAlignment="Center" />
                        <TextBlock Classes="ErrorTitle"
                            Text="Configuration Error"
                            VerticalAlignment="Center" />
                    </StackPanel>
                </Border>

                <!-- Error Message -->
                <TextBlock Classes="ErrorMessage"
                    Text="{CompiledBinding Message}"
                    Margin="0,0,0,16" />

                <!-- Error Details (Key) -->
                <StackPanel Spacing="6" Margin="0,0,0,16">
                    <TextBlock Text="Configuration Key:"
                        FontSize="12"
                        FontWeight="Medium"
                        Foreground="{DynamicResource ThemeV2.Text.Secondary}" />
                    <Border Background="{DynamicResource ThemeV2.Surface.Secondary}"
                        BorderBrush="{DynamicResource ThemeV2.Border.Default}"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="8">
                        <TextBlock Classes="ErrorDetails"
                            Text="{CompiledBinding Key}" />
                    </Border>
                </StackPanel>

                <!-- Severity Badge -->
                <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,0,0,16">
                    <TextBlock Text="Severity:"
                        FontSize="12"
                        FontWeight="Medium"
                        Foreground="{DynamicResource ThemeV2.Text.Secondary}"
                        VerticalAlignment="Center" />
                    <Border Background="{DynamicResource ThemeV2.Error.Background}"
                        BorderBrush="{DynamicResource ThemeV2.Error.Border}"
                        BorderThickness="1"
                        CornerRadius="12"
                        Padding="8,4">
                        <TextBlock Text="{CompiledBinding Severity}"
                            FontSize="11"
                            FontWeight="SemiBold"
                            Foreground="{DynamicResource ThemeV2.Error.Default}" />
                    </Border>
                </StackPanel>

                <!-- User Action (if provided) -->
                <Border Classes="UserActionBox"
                    IsVisible="{CompiledBinding UserAction, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                    <StackPanel Spacing="8">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="ℹ"
                                FontSize="16"
                                Foreground="{DynamicResource ThemeV2.Info.Default}"
                                VerticalAlignment="Top" />
                            <TextBlock Text="What you can do:"
                                FontSize="13"
                                FontWeight="SemiBold"
                                Foreground="{DynamicResource ThemeV2.Text.Primary}"
                                VerticalAlignment="Center" />
                        </StackPanel>
                        <TextBlock Text="{CompiledBinding UserAction}"
                            FontSize="13"
                            Foreground="{DynamicResource ThemeV2.Text.Primary}"
                            TextWrapping="Wrap"
                            Margin="24,0,0,0" />
                    </StackPanel>
                </Border>

                <!-- Timestamp -->
                <TextBlock
                    Text="{CompiledBinding Timestamp, StringFormat='Occurred at {0:HH:mm:ss}'}"
                    FontSize="11"
                    FontStyle="Italic"
                    Foreground="{DynamicResource ThemeV2.Text.Disabled}"
                    Margin="0,16,0,0" />
            </StackPanel>
        </Border>

        <!-- Action Buttons -->
        <Border Grid.Row="1"
            Background="{DynamicResource ThemeV2.Surface.Background}"
            BorderBrush="{DynamicResource ThemeV2.Border.Default}"
            BorderThickness="0,1,0,0"
            Padding="24,16">
            <Grid ColumnDefinitions="*,Auto,Auto">
                <!-- Spacer -->
                <Panel Grid.Column="0" />

                <!-- Retry Button (if applicable) -->
                <Button Grid.Column="1"
                    Classes="RetryButton"
                    Content="Retry"
                    Click="RetryButton_Click"
                    Margin="0,0,12,0"
                    TabIndex="0" />

                <!-- Close Button -->
                <Button Grid.Column="2"
                    Classes="CloseButton"
                    Content="Close"
                    Click="CloseButton_Click"
                    IsDefault="True"
                    TabIndex="1" />
            </Grid>
        </Border>
    </Grid>
</Window>
