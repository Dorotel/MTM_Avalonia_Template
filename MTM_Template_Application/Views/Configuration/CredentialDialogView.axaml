<Window xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:MTM_Template_Application.ViewModels.Configuration"
    mc:Ignorable="d" d:DesignWidth="500" d:DesignHeight="400"
    x:Class="MTM_Template_Application.Views.Configuration.CredentialDialogView"
    x:DataType="vm:CredentialDialogViewModel"
    x:CompileBindings="True"
    Title="{CompiledBinding DialogTitle}"
    Width="500" Height="400"
    MinWidth="450" MinHeight="350"
    CanResize="False"
    WindowStartupLocation="CenterOwner"
    ShowInTaskbar="False"
    Icon="/Assets/avalonia-logo.ico">

    <Design.DataContext>
        <vm:CredentialDialogViewModel />
    </Design.DataContext>

    <Window.Styles>
        <!-- Dialog Container Style -->
        <Style Selector="Border.DialogContainer">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Surface.Background}" />
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeV2.Border.Default}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="{DynamicResource ThemeV2.CornerRadius.Large}" />
            <Setter Property="Padding" Value="24" />
        </Style>

        <!-- Header Style -->
        <Style Selector="TextBlock.DialogHeader">
            <Setter Property="FontSize" Value="20" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="{DynamicResource ThemeV2.Text.Primary}" />
            <Setter Property="Margin" Value="0,0,0,16" />
        </Style>

        <!-- Message Style -->
        <Style Selector="TextBlock.DialogMessage">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Foreground" Value="{DynamicResource ThemeV2.Text.Secondary}" />
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="Margin" Value="0,0,0,24" />
        </Style>

        <!-- Input Field Style -->
        <Style Selector="TextBox.CredentialInput">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Input.Background}" />
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeV2.Input.Border}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="{DynamicResource ThemeV2.CornerRadius.Medium}" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Foreground" Value="{DynamicResource ThemeV2.Text.Primary}" />
            <Setter Property="MinHeight" Value="40" />
        </Style>

        <Style Selector="TextBox.CredentialInput:focus">
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeV2.Primary.Default}" />
            <Setter Property="BorderThickness" Value="2" />
        </Style>

        <!-- Password Box Style -->
        <Style Selector="TextBox.PasswordInput">
            <Setter Property="PasswordChar" Value="●" />
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Input.Background}" />
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeV2.Input.Border}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="{DynamicResource ThemeV2.CornerRadius.Medium}" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Foreground" Value="{DynamicResource ThemeV2.Text.Primary}" />
            <Setter Property="MinHeight" Value="40" />
        </Style>

        <Style Selector="TextBox.PasswordInput:focus">
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeV2.Primary.Default}" />
            <Setter Property="BorderThickness" Value="2" />
        </Style>

        <!-- Label Style -->
        <Style Selector="TextBlock.FieldLabel">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="Foreground" Value="{DynamicResource ThemeV2.Text.Primary}" />
            <Setter Property="Margin" Value="0,0,0,6" />
        </Style>

        <!-- Error Message Style -->
        <Style Selector="TextBlock.ErrorMessage">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Foreground" Value="{DynamicResource ThemeV2.Error.Default}" />
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="Margin" Value="0,8,0,0" />
        </Style>

        <!-- Button Styles -->
        <Style Selector="Button.PrimaryButton">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Primary.Default}" />
            <Setter Property="Foreground" Value="{DynamicResource ThemeV2.Text.OnPrimary}" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="CornerRadius" Value="{DynamicResource ThemeV2.CornerRadius.Medium}" />
            <Setter Property="Padding" Value="24,10" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="MinWidth" Value="100" />
            <Setter Property="Height" Value="40" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>

        <Style Selector="Button.PrimaryButton:pointerover">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Primary.Hover}" />
        </Style>

        <Style Selector="Button.PrimaryButton:pressed">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Primary.Active}" />
        </Style>

        <Style Selector="Button.PrimaryButton:disabled">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Primary.Disabled}" />
            <Setter Property="Foreground" Value="{DynamicResource ThemeV2.Text.Disabled}" />
            <Setter Property="Cursor" Value="Arrow" />
        </Style>

        <Style Selector="Button.SecondaryButton">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="{DynamicResource ThemeV2.Text.Secondary}" />
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeV2.Border.Default}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="{DynamicResource ThemeV2.CornerRadius.Medium}" />
            <Setter Property="Padding" Value="24,10" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="MinWidth" Value="100" />
            <Setter Property="Height" Value="40" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>

        <Style Selector="Button.SecondaryButton:pointerover">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Surface.Hover}" />
            <Setter Property="BorderBrush" Value="{DynamicResource ThemeV2.Border.Hover}" />
        </Style>

        <Style Selector="Button.SecondaryButton:pressed">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Surface.Active}" />
        </Style>

        <Style Selector="Button.WarningButton">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Warning.Default}" />
            <Setter Property="Foreground" Value="{DynamicResource ThemeV2.Text.OnWarning}" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="CornerRadius" Value="{DynamicResource ThemeV2.CornerRadius.Medium}" />
            <Setter Property="Padding" Value="24,10" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="MinWidth" Value="100" />
            <Setter Property="Height" Value="40" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>

        <Style Selector="Button.WarningButton:pointerover">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Warning.Hover}" />
        </Style>

        <Style Selector="Button.WarningButton:pressed">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Warning.Active}" />
        </Style>

        <Style Selector="Button.WarningButton:disabled">
            <Setter Property="Background" Value="{DynamicResource ThemeV2.Warning.Disabled}" />
            <Setter Property="Foreground" Value="{DynamicResource ThemeV2.Text.Disabled}" />
            <Setter Property="Cursor" Value="Arrow" />
        </Style>
    </Window.Styles>

    <!-- Main Content -->
    <Grid Margin="0" RowDefinitions="*,Auto">
        <!-- Dialog Content -->
        <Border Classes="DialogContainer" Grid.Row="0" Margin="0">
            <StackPanel Spacing="0">
                <!-- Header -->
                <TextBlock Classes="DialogHeader" Text="{CompiledBinding DialogTitle}" />

                <!-- Message -->
                <TextBlock Classes="DialogMessage" Text="{CompiledBinding DialogMessage}" />

                <!-- Username Field -->
                <StackPanel Spacing="0" Margin="0,0,0,16">
                    <TextBlock Classes="FieldLabel" Text="Username" />
                    <TextBox Classes="CredentialInput"
                        Text="{CompiledBinding Username}"
                        Watermark="Enter your Visual ERP username"
                        TabIndex="0" />
                </StackPanel>

                <!-- Password Field -->
                <StackPanel Spacing="0" Margin="0,0,0,16">
                    <TextBlock Classes="FieldLabel" Text="Password" />
                    <TextBox Classes="PasswordInput"
                        Text="{CompiledBinding Password}"
                        Watermark="Enter your Visual ERP password"
                        PasswordChar="●"
                        TabIndex="1" />
                </StackPanel>

                <!-- Error Message -->
                <TextBlock Classes="ErrorMessage"
                    Text="{CompiledBinding ErrorMessage}"
                    IsVisible="{CompiledBinding HasErrorMessage}"
                    Margin="0,0,0,16" />

                <!-- Loading Indicator -->
                <StackPanel Orientation="Horizontal"
                    Spacing="12"
                    HorizontalAlignment="Center"
                    IsVisible="{CompiledBinding IsLoading}"
                    Margin="0,0,0,16">
                    <ProgressBar IsIndeterminate="True"
                        Width="200"
                        Height="4"
                        Foreground="{DynamicResource ThemeV2.Primary.Default}" />
                    <TextBlock Text="Saving credentials..."
                        FontSize="13"
                        Foreground="{DynamicResource ThemeV2.Text.Secondary}"
                        VerticalAlignment="Center" />
                </StackPanel>

                <!-- Retry Attempts Info (NFR-017) -->
                <StackPanel IsVisible="{CompiledBinding ShowRetryAttempts}"
                    Orientation="Horizontal"
                    Spacing="8"
                    Margin="0,0,0,16">
                    <TextBlock Text="⚠"
                        FontSize="16"
                        Foreground="{DynamicResource ThemeV2.Warning.Default}"
                        VerticalAlignment="Center" />
                    <TextBlock FontSize="13"
                        Foreground="{DynamicResource ThemeV2.Text.Secondary}"
                        VerticalAlignment="Center">
                        <Run Text="Failed attempts: " />
                        <Run Text="{CompiledBinding RetryAttempts}" FontWeight="SemiBold" />
                        <Run Text=" of 3. After 3 failed attempts, use the Retry button." />
                    </TextBlock>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Action Buttons -->
        <Border Grid.Row="1"
            Background="{DynamicResource ThemeV2.Surface.Background}"
            BorderBrush="{DynamicResource ThemeV2.Border.Default}"
            BorderThickness="0,1,0,0"
            Padding="24,16">
            <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                <!-- Retry Button (NFR-017 - shown after 3 failed attempts) -->
                <Button Grid.Column="0"
                    Classes="WarningButton"
                    Content="Retry"
                    Command="{CompiledBinding RetryCommand}"
                    IsVisible="{CompiledBinding ShowRetryButton}"
                    ToolTip.Tip="Manual retry after automatic retry limit reached"
                    Margin="0,0,12,0"
                    TabIndex="3" />

                <!-- Spacer -->
                <Panel Grid.Column="1" />

                <!-- Cancel Button -->
                <Button Grid.Column="2"
                    Classes="SecondaryButton"
                    Content="Cancel"
                    Command="{CompiledBinding CancelCommand}"
                    Margin="0,0,12,0"
                    TabIndex="4" />

                <!-- Submit Button -->
                <Button Grid.Column="3"
                    Classes="PrimaryButton"
                    Content="Save Credentials"
                    Command="{CompiledBinding SubmitCommand}"
                    IsDefault="True"
                    TabIndex="2" />
            </Grid>
        </Border>
    </Grid>
</Window>
